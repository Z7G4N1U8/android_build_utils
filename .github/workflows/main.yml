name: Build

on:
  workflow_dispatch:
    inputs:
      android:
        description: "ROM to build"
        required: true
        default: "LineageOS"
        type: choice
        options: [LineageOS, Evolution-X]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Build
        uses: appleboy/ssh-action@master
        env:
          ANDROID: ${{ inputs.android }}
          BB_KEY: ${{ secrets.bb_key }}
          GH_ACTOR: ${{ github.actor }}
          GH_REPOSITORY: ${{ github.repository }}
          RCLONE_CONF: ${{ secrets.rclone_conf }}
          SSH_KEY: ${{ secrets.ssh_key }}
        with:
          host: ${{ secrets.gce_host }}
          username: ${{ secrets.gce_user }}
          key: ${{ secrets.ssh_key }}
          script: curl -LSs https://raw.githubusercontent.com/${{ github.repository }}/refs/heads/main/scripts/build.sh | bash
          envs: ANDROID,BB_KEY,GH_ACTOR,GH_REPOSITORY,RCLONE_CONF,SSH_KEY
          command_timeout: 3h
